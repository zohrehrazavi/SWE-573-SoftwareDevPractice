<!DOCTYPE html>
<html>
  <head>
    <title>Home - Connect the Dots</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/home.css' %}" />
    <!-- Add Font Awesome for the trash icon -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .board-tags {
        margin-top: 6px;
      }
      .tag-pill {
        display: inline-block;
        background: #e0e7ef;
        color: #333;
        border-radius: 12px;
        padding: 2px 10px;
        font-size: 0.9em;
        margin-right: 4px;
        margin-bottom: 2px;
      }
      .toggle-group {
        display: flex;
        align-items: center;
        background: #f3f4f6;
        border-radius: 30px;
        padding: 6px 10px;
        margin-bottom: 16px;
        width: fit-content;
        box-shadow: 0 2px 6px #0001;
      }
      .toggle-btn {
        border: none;
        outline: none;
        background: #e5e7eb;
        color: #374151;
        font-weight: bold;
        font-size: 1.1em;
        padding: 10px 28px;
        border-radius: 22px;
        margin: 0 2px;
        cursor: pointer;
        transition: background 0.2s, color 0.2s;
        text-decoration: none;
        box-shadow: none;
      }
      .toggle-btn.active-toggle {
        background: #60a5fa;
        color: #fff;
        box-shadow: 0 2px 6px #0002;
      }
      .toggle-btn:not(.active-toggle):hover {
        background: #d1d5db;
        color: #374151;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header with welcome message and logout -->
      <header class="header">
        <div class="welcome-section">
          <h1>
            Welcome!
            <span class="username">{{ user.username }}</span>
          </h1>
        </div>
        <form method="post" action="{% url 'logout' %}" style="margin: 0;">
          {% csrf_token %}
          <button type="submit" class="logout-btn">Logout</button>
        </form>
      </header>

      <div class="main-content">
        <!-- Left side: Search and Create Board -->
        <div class="search-section">
          <input
            type="text"
            class="search-bar"
            placeholder="Search boards by name or tags..."
            id="boardSearch"
          />
          <a href="{% url 'create_board' %}" class="create-board-btn">
            Create a New Research Board
          </a>
        </div>

        <!-- Right side: Boards List -->
        <div class="boards-section">
          <div class="toggle-group">
            <a
              href="?show=my"
              class="toggle-btn{% if show != 'all' %} active-toggle{% endif %}"
            >
              My Boards
            </a>
            <a
              href="?show=all"
              class="toggle-btn{% if show == 'all' %} active-toggle{% endif %}"
            >
              All Boards
            </a>
          </div>
          {% if boards %}
          <ul class="boards-list">
            {% for board in boards %}
            <li class="board-item">
              <div
                class="board-content"
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                "
              >
                <a href="{% url 'board_detail' board.id %}" class="board-link">
                  {{ board.name }}
                </a>
                {% if board.owner == user %}
                <button
                  class="delete-btn"
                  onclick="confirmDelete('{{ board.id }}', '{{ board.name|escapejs }}')"
                  title="Delete board"
                  style="margin-left: 10px;"
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
                {% endif %}
              </div>
              <div class="board-meta">
                By {{ board.owner.username }} &bull; {{ board.created_at }}
              </div>
              {% if board.board_tags %}
              <div class="board-tags">
                {% for tag in board.board_tags %}
                <span class="tag-pill">{{ tag }}</span>
                {% endfor %}
              </div>
              {% endif %}
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p>
            {% if show == 'all' %}No boards found.{% else %}You haven't created
            any boards yet.{% endif %}
          </p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
      <div class="modal-content">
        <h3>Delete Board</h3>
        <p id="deleteMessage"></p>
        <div class="modal-buttons">
          <button onclick="closeModal()" class="cancel-btn">Cancel</button>
          <form id="deleteForm" method="POST" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="confirm-delete-btn">Delete</button>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Simple client-side search functionality
      document
        .getElementById('boardSearch')
        .addEventListener('input', function (e) {
          const searchTerm = e.target.value.toLowerCase()
          const boardItems = document.querySelectorAll('.board-item')

          boardItems.forEach((item) => {
            const boardName = item
              .querySelector('.board-link')
              .textContent.toLowerCase()
            // Get all tag elements inside this board item
            const tagElements = item.querySelectorAll('.tag-pill')
            // Create an array of tag texts
            const tags = Array.from(tagElements).map((tagEl) =>
              tagEl.textContent.toLowerCase(),
            )
            // Check if search term is in board name or any tag
            const matches =
              boardName.includes(searchTerm) ||
              tags.some((tag) => tag.includes(searchTerm))
            if (matches) {
              item.style.display = ''
            } else {
              item.style.display = 'none'
            }
          })
        })

      // Delete confirmation functionality
      function confirmDelete(boardId, boardName) {
        const modal = document.getElementById('deleteModal')
        const deleteMessage = document.getElementById('deleteMessage')
        const deleteForm = document.getElementById('deleteForm')

        deleteMessage.textContent = `Are you sure you want to delete "${boardName}"?`
        deleteForm.action = `/board/${boardId}/delete/`
        modal.style.display = 'flex'
      }

      function closeModal() {
        const modal = document.getElementById('deleteModal')
        modal.style.display = 'none'
      }

      // Close modal when clicking outside
      window.onclick = function (event) {
        const modal = document.getElementById('deleteModal')
        if (event.target == modal) {
          modal.style.display = 'none'
        }
      }
    </script>
  </body>
</html>
